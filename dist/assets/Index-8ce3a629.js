import{d as C,Q as Y,s as j,a6 as F,o as c,p as D,w as a,a as t,e as g,j as w,c as k,b as n,t as m,u as x,N as O,V as A,F as W,f as L,r as $,I as R,Z as U,m as E}from"./index-1b2f18c0.js";import{_ as q}from"./LineChart.vue_vue_type_script_setup_true_lang-31c950ee.js";import{c as Q,d as Z,V,t as P,a as G,b as K}from"./VCard-81742aa1.js";import{V as b,a as z}from"./VRow-bf742394.js";import{V as X}from"./VDivider-04be6cf6.js";import{V as ee}from"./VChip-df0715a8.js";import{V as te}from"./VMenu-98fd1c6a.js";import{_ as ae}from"./ManualAttendanceDialog.vue_vue_type_script_setup_true_lang-f61a0a11.js";import{V as N}from"./VSpacer-58a18ea2.js";import{V as J}from"./VBtn-5eaa95be.js";import{V as le}from"./VContainer-45cc6a4e.js";import{V as se,a as ne}from"./VTable-b15a121d.js";import"./index-100a9889.js";import"./index-45aa9782.js";import"./VOverlay-ab69c83c.js";import"./forwardRefs-9d31fcaa.js";import"./delay-c95e4996.js";import"./scopeId-5749c772.js";import"./useStudent-b532c908.js";import"./VList-7ef54800.js";import"./ssrBoot-a37f06b1.js";import"./VInput-c0b26070.js";import"./VSelectionControl-f61f6b98.js";import"./VProgressCircular-a7f3ca87.js";import"./VDialog-d2e18591.js";const oe="/assets/data-quality-f053b913.png",re=C({__name:"StudentLineChart",props:["month"],setup(p){const s=p,{current:y}=Y(),{student:h}=j(F()),l=()=>{let f=h.value.attendances.slice().filter(o=>new Date(o.created_at).getMonth()==s.month).sort((o,r)=>new Date(o.created_at)-new Date(r.created_at)),_=[],v=[f[0]];return f.length>1&&f.slice(1).forEach(o=>{let r=new Date(o.created_at),i=new Date(v[0].created_at),e=new Date(v[0].created_at),u=new Date(v[0].created_at),d=e.getDate()-i.getDay();e.setDate(d),u.setDate(d+6),r.setHours(0,0,0,0),e<=r&&u>=r?v.push(o):(_.push(v),v=[o])}),v.length>0&&_.push(v),{labels:_.map((o,r)=>"Week "+(r+1)),datasets:[{backgroundColor:y.value.colors.primary,borderJoinStyle:"round",borderColor:y.value.colors.primary,tension:.1,data:_.map(o=>o.reduce((r,i)=>r+=(i==null?void 0:i.work_time)||0,0))}]}};return(f,_)=>(c(),D(V,{class:"h-100 border rounded-lg pa-md-4 pa-0",flat:""},{default:a(()=>[t(Q,null,{default:a(()=>[g(" Weekly work time ")]),_:1}),t(Z,{class:"pa-0"},{default:a(()=>[t(q,{style:{height:"350px"},data:l(),class:"pa-5"},null,8,["data"])]),_:1})]),_:1}))}}),ie=C({__name:"AttendanceListItem",props:{attendance:{}},setup(p){const s=p;j(F());const y=w(()=>s.attendance&&s.attendance.time_in?new Date(s.attendance.time_in).toLocaleTimeString():"--"),h=w(()=>s.attendance&&s.attendance.time_out?new Date(s.attendance.time_out).toLocaleTimeString():"--"),l=w(()=>s.attendance&&s.attendance.time_in&&s.attendance.time_out?parseFloat(s.attendance.work_time).toFixed(2)+"h":"--");return(f,_)=>(c(),k("tr",null,[n("td",null,m(new Date(f.attendance.created_at).toDateString()),1),n("td",null,m(y.value),1),n("td",null,m(h.value),1),n("td",null,m(l.value),1)]))}}),ue={key:0},ce={class:"font-weight-medium"},de={class:"font-weight-medium"},me={class:"font-weight-medium"},fe={key:1,class:"d-flex"},_e={class:"font-weight-medium"},ve={class:"font-weight-medium"},pe={class:"font-weight-medium"},he={class:"d-flex text-subtitle-2 align-center justify-sm-space-between"},ge={inheritAttrs:!0},we=C({...ge,__name:"CalendarBoxDay",props:{day:{},month:{}},setup(p){const s=p,{student:y}=j(F()),h=w(()=>y.value.attendances.filter(e=>new Date(e.created_at).getDate()==s.day&&new Date(e.created_at).getMonth()==s.month)),l=w(()=>{const e=new Date,u=new Date(e.getFullYear(),s.month,s.day);return u.setHours(0),u.setMinutes(0),u.setSeconds(0),u.setMilliseconds(0),y.value.attendances.find(d=>{var B,H;const M=new Date(((B=d.event)==null?void 0:B.date_time.event_date_start)||0);M.setHours(0),M.setMinutes(0),M.setSeconds(0),M.setMilliseconds(0);const T=new Date(((H=d.event)==null?void 0:H.date_time.event_date_end)||0);T.setHours(0),T.setMinutes(0),T.setSeconds(0),T.setMilliseconds(0);const S=new Date(d.created_at);return S.setHours(0),S.setMinutes(0),S.setSeconds(0),S.setMilliseconds(0),S.getTime()==u.getTime()&&!d.is_event||d.event&&M.getTime()<=u.getTime()&&T.getTime()>=u.getTime()})}),f=w(()=>e=>e?new Date(e.created_at).toDateString():"-- -- --"),_=w(()=>e=>e?e.is_absent?{variant:"elevated",color:"error"}:e.policy&&e.time_out?{variant:"elevated",color:"warning"}:e.is_event?{variant:"elevated",color:"green"}:!e.time_in||!e.time_out&&!e.is_event?{variant:"outlined",color:"primary"}:{variant:"elevated",color:"primary"}:{variant:"outlined",color:"primary"}),v=w(()=>e=>e&&e.time_in?new Date(e.time_in).toLocaleTimeString():"--"),o=w(()=>e=>e&&e.time_out?new Date(e.time_out).toLocaleTimeString():"--"),r=w(()=>e=>e&&e.time_in&&e.time_out?parseInt(e.work_time).toFixed(0)+"h":"--"),i=w(()=>e=>e!=null&&e.is_absent?"absent":e!=null&&e.policy?"late":e!=null&&e.time_in&&e.time_out?"present":e!=null&&e.is_event?"event":"pending");return(e,u)=>(c(),D(te,{"open-on-hover":"","open-delay":"500"},{activator:a(({props:d})=>[Array.isArray(x(y).attendances)?(c(),D(V,O({key:0},{...d,...e.$attrs},{flat:"",color:_.value(l.value).color,variant:_.value(l.value).variant,class:"mr-2 d-flex align-center justify-center",height:"45",style:{"user-select":"none"},width:"45"}),{default:a(()=>[g(m(e.day),1)]),_:2},1040,["color","variant"])):A("",!0)]),default:a(()=>[t(V,{width:"380",class:"pa-3 rounded-lg",style:{"user-select":"none"}},{default:a(()=>[n("div",null,[h.value.length>0?(c(),k("div",ue,[(c(!0),k(W,null,L(h.value,d=>(c(),k("div",{class:"d-flex",key:d.id},[t(b,{class:"d-flex align-center justify-end font-weight-regular flex-column flex-column-reverse"},{default:a(()=>[g(" Time in "),n("span",ce,m(v.value(d)),1)]),_:2},1024),t(b,{class:"d-flex align-center justify-end font-weight-regular flex-column flex-column-reverse"},{default:a(()=>[g("Time out "),n("span",de,m(o.value(d)),1)]),_:2},1024),t(b,{class:"d-flex align-center justify-end font-weight-regular flex-column flex-column-reverse"},{default:a(()=>[g("Work time "),n("span",me,m(r.value(d)),1)]),_:2},1024)]))),128))])):(c(),k("div",fe,[t(b,{class:"d-flex align-center justify-end font-weight-regular flex-column flex-column-reverse"},{default:a(()=>[g(" Time in "),n("span",_e,m(v.value(l.value)),1)]),_:1}),t(b,{class:"d-flex align-center justify-end font-weight-regular flex-column flex-column-reverse"},{default:a(()=>[g("Time out "),n("span",ve,m(o.value(l.value)),1)]),_:1}),t(b,{class:"d-flex align-center justify-end font-weight-regular flex-column flex-column-reverse"},{default:a(()=>[g("Work time "),n("span",pe,m(r.value(l.value)),1)]),_:1})]))]),t(X,{class:"my-1"}),n("div",he,[n("span",null,[t(P,{size:"23"},{default:a(()=>[g("mdi-clock-outline")]),_:1}),g(" "+m(f.value(l.value)),1)]),t(ee,{color:i.value(l.value)=="absent"?"error":i.value(l.value)=="present"?"primary":i.value(l.value)=="late"?"warning":i.value(l.value)=="event"?"green":"grey",class:"text-capitalize",size:"small"},{default:a(()=>[g(m(i.value(l.value)),1)]),_:1},8,["color"])])]),_:1})]),_:1}))}}),ye={class:"d-flex align-center w-100"},xe={class:"d-flex flex-wrap justify-space-between"},De=C({__name:"Calendar",props:["selectedMonth"],emits:["update:selectedMonth"],setup(p,{emit:s}){const y=p,h=$(!1),l=$(new Date),f=["January","February","March","April","May","June","July","August","September","October","November","December"],_=new Date,v=_.getFullYear(),o=w(()=>new Date(v,y.selectedMonth+1,0).getDate()),r=i=>{const e=new Date(_.getFullYear(),y.selectedMonth,i);console.log(e),l.value=e};return R(()=>l.value,()=>{h.value=!0}),(i,e)=>(c(),D(V,{class:"pa-3 border h-100 rounded-lg",flat:""},{default:a(()=>[t(V,{class:"pl-1 mt-1 h-100 mb-5",flat:""},{default:a(()=>[n("div",ye,[n("h3",null,[t(P,{class:"mr-3"},{default:a(()=>[g("mdi-calendar")]),_:1}),g(m(f[p.selectedMonth])+" "+m(x(v)),1)]),t(N),t(J,{icon:"mdi-chevron-left",class:"rounded-lg mr-2",flat:"",onClick:e[0]||(e[0]=u=>s("update:selectedMonth",p.selectedMonth-1)),disabled:p.selectedMonth<1,variant:"text"},null,8,["disabled"]),t(J,{icon:"mdi-chevron-right",class:"rounded-lg",flat:"",onClick:e[1]||(e[1]=u=>s("update:selectedMonth",p.selectedMonth+1)),disabled:p.selectedMonth>10,variant:"text"},null,8,["disabled"])]),n("div",xe,[(c(!0),k(W,null,L(o.value,(u,d)=>(c(),D(we,{class:"my-2",status:"absent",key:u+d,day:u,month:p.selectedMonth,onDblclick:M=>r(parseInt(u.toString())),onClick:e[2]||(e[2]=U(()=>{},["prevent"]))},null,8,["day","month","onDblclick"]))),128)),t(N)]),(c(),D(ae,{start_at:l.value,key:l.value,"show-dialog":h.value,"onUpdate:showDialog":e[3]||(e[3]=u=>h.value=u)},null,8,["start_at","show-dialog"]))]),_:1})]),_:1}))}}),be=n("h2",{class:"ml-2"},"No chart",-1),ke={key:0},Ve=n("thead",null,[n("tr",null,[n("th",null,"Date"),n("th",null,"Time in"),n("th",null,"Time out"),n("th",null,"Work time")])],-1),Me={key:0,div:"",class:"w-100 align-center mt-5 px-5 pb-5 d-flex"},I=9,Ke=C({__name:"Index",setup(p){const{mobile:s}=E(),h=$(new Date().getMonth()),{student:l}=j(F()),f=$(1);let _=w(()=>{var o;return Math.ceil((((o=l.value.attendances)==null?void 0:o.length)||0)/I)});const v=w(()=>l.value.attendances.slice().sort((o,r)=>new Date(r.created_at)-new Date(o.created_at)));return(o,r)=>(c(),D(le,{class:"px-0",fluid:""},{default:a(()=>[t(z,{"align-content":"stretch"},{default:a(()=>[t(b,{cols:x(s)?12:8},{default:a(()=>[x(l).attendances&&x(l).attendances.length>0?(c(),D(re,{key:0,style:{height:"50px"},month:h.value},null,8,["month"])):(c(),D(V,{key:1,class:"pa-5 d-flex align-center justify-center rounded-lg border",flat:"",height:"450"},{default:a(()=>[t(G,{class:"mr-4",size:"60"},{default:a(()=>[t(K,{src:oe})]),_:1}),be]),_:1}))]),_:1},8,["cols"]),t(b,{cols:x(s)?12:4},{default:a(()=>[t(De,{"selected-month":h.value,"onUpdate:selectedMonth":r[0]||(r[0]=i=>h.value=i)},null,8,["selected-month"])]),_:1},8,["cols"])]),_:1}),t(z,null,{default:a(()=>[t(b,null,{default:a(()=>[x(l).attendances&&x(l).attendances.length>0?(c(),k("div",ke,[t(V,{style:{"overflow-x":"auto"},class:"border rounded-lg d-flex flex-column",flat:""},{default:a(()=>[t(se,{hover:"",striped:""},{default:a(()=>[Ve,n("tbody",null,[(c(!0),k(W,null,L(v.value.slice((f.value-1)*I,f.value*I),i=>(c(),D(ie,{key:i.id,attendance:i},null,8,["attendance"]))),128))])]),_:1}),x(_)>1?(c(),k("div",Me,[g(" Page "+m(f.value)+" / "+m(x(_))+" ",1),t(N),t(ne,{length:x(_),color:"primary","total-visible":x(s)?1:5,modelValue:f.value,"onUpdate:modelValue":r[1]||(r[1]=i=>f.value=i)},null,8,["length","total-visible","modelValue"])])):A("",!0)]),_:1})])):A("",!0)]),_:1})]),_:1})]),_:1}))}});export{Ke as default};
